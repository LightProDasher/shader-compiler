From 90f251e2a90b43f4f74d17744decd1726021c052 Mon Sep 17 00:00:00 2001
From: Billy Laws <blaws05@gmail.com>
Date: Sat, 7 Jan 2023 15:07:03 +0000
Subject: [PATCH 12/14] Label generated SPIR-V shaders with input name

---
 backend/spirv/emit_spirv.cpp | 6 +++++-
 backend/spirv/emit_spirv.h   | 6 +++---
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/backend/spirv/emit_spirv.cpp b/backend/spirv/emit_spirv.cpp
index 351f859..05edebe 100644
--- a/backend/spirv/emit_spirv.cpp
+++ b/backend/spirv/emit_spirv.cpp
@@ -482,8 +482,12 @@ void PatchPhiNodes(IR::Program& program, EmitContext& ctx) {
 } // Anonymous namespace
 
 std::vector<u32> EmitSPIRV(const Profile& profile, const RuntimeInfo& runtime_info,
-                           IR::Program& program, Bindings& bindings) {
+                           IR::Program& program, Bindings& bindings, std::string_view name) {
     EmitContext ctx{profile, runtime_info, program, bindings};
+    if (!name.empty()) {
+        ctx.String(name);
+    }
+
     const Id main{DefineMain(ctx, program)};
     DefineEntryPoint(program, ctx, main);
     if (profile.support_float_controls) {
diff --git a/backend/spirv/emit_spirv.h b/backend/spirv/emit_spirv.h
index 9378814..a78c7e6 100644
--- a/backend/spirv/emit_spirv.h
+++ b/backend/spirv/emit_spirv.h
@@ -31,11 +31,11 @@ constexpr u32 RESCALING_LAYOUT_DOWN_FACTOR_OFFSET = offsetof(RescalingLayout, do
 constexpr u32 RENDERAREA_LAYOUT_OFFSET = offsetof(RenderAreaLayout, render_area);
 
 [[nodiscard]] std::vector<u32> EmitSPIRV(const Profile& profile, const RuntimeInfo& runtime_info,
-                                         IR::Program& program, Bindings& bindings);
+                                         IR::Program& program, Bindings& bindings, std::string_view name = {});
 
-[[nodiscard]] inline std::vector<u32> EmitSPIRV(const Profile& profile, IR::Program& program) {
+[[nodiscard]] inline std::vector<u32> EmitSPIRV(const Profile& profile, IR::Program& program, std::string_view name = {}) {
     Bindings binding;
-    return EmitSPIRV(profile, {}, program, binding);
+    return EmitSPIRV(profile, {}, program, binding, name);
 }
 
 } // namespace Shader::Backend::SPIRV
-- 
2.38.1

